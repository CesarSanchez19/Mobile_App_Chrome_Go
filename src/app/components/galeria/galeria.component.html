<div class="main">
  <div class="galeria-segment">
    <ion-segment class="custom" value="historial">
      <ion-segment-button class="button-custom" value="historial" content-id="historial">
        <ion-label>Historial</ion-label>
      </ion-segment-button>
      <ion-segment-button class="button-custom" value="categorias" content-id="categorias">
        <ion-label>Mis categorías</ion-label>
      </ion-segment-button>
    </ion-segment>

    <!-- Vistas -->
    <ion-segment-view>
      <!-- Historial -->
      <ion-segment-content id="historial">
        <div class="scroll-container">
          <!-- Cartas en forma de lista para los colores -->
          <ion-segment-content>
            <!-- Iteramos sobre los colores -->
            <ion-card class="cards" *ngFor="let color of colores">
              <ion-card-header>
                <ion-card-content>
                  <ion-grid>
                    <ion-row>
                      <ion-col size="2" class="color-container">
                        <div
                          class="color-box"
                          [ngStyle]="{'background-color': color.hex}"
                        ></div>
                      </ion-col>
                      <ion-col size="10" class="text-container">
                        <div class="union">
                          <div class="text-container">
                            <!-- Si se está editando este color, mostramos un input -->
                            <ng-container *ngIf="editingColorId === color.id; else viewMode">
                              <ion-input
                                [(ngModel)]="editingColorName"
                                (keyup.enter)="saveEditing(color)"
                                (blur)="cancelEditing()"
                              ></ion-input>
                            </ng-container>
                            <!-- Modo vista normal -->
                            <ng-template #viewMode>
                              <ion-card-title (dblclick)="enableEditing(color)">
                                {{ color.name }}
                              </ion-card-title>
                            </ng-template>

                            <ion-card-subtitle>
                              {{ color.hex }}
                            </ion-card-subtitle>
                          </div>
                          <div class="icon-container">
                            <ion-icon name="add-circle-outline" class="icon"></ion-icon>
                            <!-- Papelera para eliminar -->
                            <ion-icon
                              name="trash-outline"
                              class="icon"
                              (click)="deleteColor(color)"
                            ></ion-icon>
                          </div>
                        </div>
                      </ion-col>
                    </ion-row>
                  </ion-grid>
                </ion-card-content>
              </ion-card-header>
            </ion-card>
          </ion-segment-content>
        </div>
      </ion-segment-content>

      <!-- Mis categorías -->
      <ion-segment-content id="categorias">
        <!-- Buscador -->
        <ion-searchbar
          show-clear-button="focus"
          class="bar-custom"
          placeholder="Buscar una categoría específica..."
        >
        </ion-searchbar>

        <!-- Botón para abrir modal -->
        <div class="button-container">
          <ion-button (click)="openModal()">Crear Categoría</ion-button>
        </div>

        <!-- Acordiones -->
        <div class="accordion-container">
          <ion-accordion-group>
            <ion-accordion
              *ngFor="let categoria of categorias"
              [value]="categoria.value"
              toggleIconSlot="start"
            >
              <ion-item slot="header" class="flex items-center justify-between">
                <ion-label>{{ categoria.label }}</ion-label>
                <!-- Botón de eliminar -->
                <ion-button
                  fill="clear"
                  color="danger"
                  (click)="eliminarCategoria(categoria)"
                >
                  <ion-icon name="trash-outline"></ion-icon>
                </ion-button>
              </ion-item>
              <div class="ion-padding" slot="content">
                {{ categoria.content }}
              </div>
            </ion-accordion>
          </ion-accordion-group>
        </div>
      </ion-segment-content>
    </ion-segment-view>
  </div>
</div>

<!-- Modal para crear categoría -->
<ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title class="title-custom">Crear Nueva Categoría</ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-item>
        <ion-label class="label-custom" position="floating">
          Nombre de la nueva categoría
        </ion-label>
        <ion-input
          class="input-custom"
          [(ngModel)]="nuevaCategoria"
        ></ion-input>
      </ion-item>
      <div class="button-container">
        <ion-button class="crear-button" (click)="crearCategoria()">Crear</ion-button>
        <ion-button class="cancelar-button" (click)="closeModal()">Cancelar</ion-button>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
